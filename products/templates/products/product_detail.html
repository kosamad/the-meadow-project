{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load crispy_forms_filters %}

{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <row class="mt-4 mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'shop' %}" class="no-link-style">Shop</a></li>                
                <li class="breadcrumb-item active" aria-current="page"><a href="{% url 'shop' %}?category={{ product.category.name }}" class="no-link-style">{{ product.category.name|title }}</a></li>               
                <li class="breadcrumb-item active" aria-current="page">{{ product.friendly_name|title }}</li>
            </ol>
        </nav>
</div>
</div>

<div class="container">
    <div class="row">
        <!-- Product Image and Description -->
        <div class="col-12 col-md-6 col-lg-4 my-4">
            <row>
                <a href="{{ product.image.url }}" target="_blank">
                    <img src="{{  product.image.url }}" class="shop-img" alt="{{ product.alt_text }}">
                </a>
            </row>
            <row class="mt-4">
                <p class="mt-4">{{ product.description }}</p>
                <p class="mt-4">The image shown is the size of one of our medium bouquets.
                    If you have any specific requirements, please add to note when checking out and we will do our best
                    to fulfill your request.
                </p>
            </row>
        </div>

        <!-- Product Order Form-->
        <div class="col-12 col-md-6 col-lg-8 align-items-start my-4">
            <div class="row">
                <h2>{{ product.friendly_name }}</h2>
            </div>
            <div class="row mt-3">
                <h4>Â£<span id="product-price">{{ product.price }}</span></h4>
            </div>
            <div class="row">
                <form method="POST" clas="form" action="{% url 'add_to_bag' product.id %}">
                    {% csrf_token %}
                    <!-- Size -->
                    <div class="col-lg-8 col-12">
                    </div>
                    <!-- Card message -->
                    <div class="col-lg-8 col-12">
                    </div>
                    <!-- Note to seller -->
                    <div class="col-lg-8 col-12">
                    </div>
                    <!-- Quantity -->
                    <div class="col-lg-2 col-4">
                        <div class="input-group">
                            <input class="form-control qty_input" type="number" name="quantity" value="1" min="1"
                                max="99" data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}">
                        </div>
                    </div>

                    <!-- Submit button -->
                    <input type="submit" class="btn-green btn mt-4" value="Add to Basket">

                    <!-- Hidden fields for use in checkout -->
                    <!-- <input type="hidden" id="id_selected_size_price" name="selected_size_price"
                        value="{{ selected_size_price }}"> -->
                    <!-- url so can return user to page after iten added to bag -->
                    <input type="hidden" name="redirect_url" value="{{ request.path }}">
                </form>
            </div>
        </div>
    </div>
</div>
</div>

{% endblock %}

{% block postloadjs %}
{{ block.super }}

<script type="text/javascript">
    // document.addEventListener('DOMContentLoaded', function () {
    //     var sizeSelect = document.getElementById('id_size');
    //     var productPriceElement = document.getElementById('product-price');
    //     var selectedSizePriceInput = document.getElementById('id_selected_size_price');
    //     var originalPrice = parseFloat('{{ product.price }}'); // Assuming product.price is a decimal number

    //     sizeSelect.addEventListener('change', function () {
    //         var selectedSize = sizeSelect.value;
    //         var adjustedPrice = originalPrice; // Default to original price for 'M'

    //         if (selectedSize === 'S') {
    //             adjustedPrice *= 0.7; // 70% of original price for small
    //         } else if (selectedSize === 'L') {
    //             adjustedPrice *= 1.3; // 130% of original price for large
    //         }

    //         productPriceElement.textContent = adjustedPrice.toFixed(2);
    //         selectedSizePriceInput.value = adjustedPrice.toFixed(2); // Set hidden input value
    //     });

    //     // Trigger initial price update on page load
    //     sizeSelect.dispatchEvent(new Event('change'));
    // });
</script>
{% endblock %}